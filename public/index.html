<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Gestionale Roleplay | Sistema Centrale</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root { --gold: #ffcc00; --bg: #0a0a0a; --card: rgba(25, 25, 25, 0.85); --curve: 40px; }
        body { margin: 0; background: var(--bg); color: white; font-family: 'Plus Jakarta Sans', sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; overflow: hidden; }
        
        .glow-bg { position: absolute; width: 600px; height: 600px; background: radial-gradient(circle, rgba(255, 204, 0, 0.05) 0%, transparent 70%); z-index: -1; animation: float 10s infinite alternate; }
        @keyframes float { from { transform: translate(-10%, -10%); } to { transform: translate(10%, 10%); } }

        .main-container { width: 900px; position: relative; display: flex; flex-direction: column; align-items: center; }
        .glass-card { background: var(--card); backdrop-filter: blur(25px); border: 1px solid rgba(255, 255, 255, 0.08); border-radius: var(--curve); padding: 50px; width: 100%; box-shadow: 0 40px 100px rgba(0,0,0,0.8); transition: 0.5s cubic-bezier(0.4, 0, 0.2, 1); position: relative; }

        /* HEADER */
        .header { text-align: center; margin-bottom: 40px; }
        .header h1 { font-size: 3.5rem; font-weight: 800; margin: 0; letter-spacing: -2px; text-transform: uppercase; }

        /* SCHERMATE */
        .screen { display: none; animation: fadeIn 0.6s ease forwards; }
        .screen.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* LANDING (PAGINA INIZIALE) */
        .landing-flex { display: flex; align-items: center; gap: 40px; }
        .viz-box { background: rgba(0,0,0,0.3); padding: 30px; border-radius: 30px; display: flex; align-items: flex-end; gap: 8px; height: 120px; }
        .bar { width: 10px; background: var(--gold); border-radius: 5px; animation: barGrow 1.5s infinite ease-in-out; }

        /* INPUT & BOTTONI */
        input { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); color: white; padding: 18px; border-radius: 20px; width: 100%; box-sizing: border-box; margin-bottom: 15px; font-size: 1rem; }
        input:focus { outline: none; border-color: var(--gold); background: rgba(255,255,255,0.08); }
        .btn { background: var(--gold); color: black; border: none; padding: 18px 35px; border-radius: 50px; font-weight: 800; cursor: pointer; transition: 0.3s; width: 100%; text-transform: uppercase; }
        .btn:hover { transform: scale(1.03); box-shadow: 0 10px 30px rgba(255,204,0,0.3); }

        /* SIDEBAR DASHBOARD */
        .sidebar { position: absolute; left: -80px; top: 50%; transform: translateY(-50%); display: flex; flex-direction: column; gap: 15px; }
        .side-btn { width: 55px; height: 55px; border-radius: 18px; border: none; background: var(--card); color: white; cursor: pointer; transition: 0.3s; font-size: 1.5rem; display: flex; align-items: center; justify-content: center; }
        .side-btn.active { background: var(--gold); color: black; box-shadow: 0 0 20px var(--gold); }

        /* STATS GRID */
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 30px; }
        .stat-card { background: rgba(255,255,255,0.03); padding: 25px; border-radius: 30px; border: 1px solid rgba(255,255,255,0.05); }
        .stat-card h4 { margin: 0; font-size: 0.75rem; color: #888; text-transform: uppercase; letter-spacing: 1px; }
        .stat-card p { margin: 10px 0 0; font-size: 1.8rem; font-weight: 800; color: var(--gold); }

        @keyframes barGrow { 0%, 100% { height: 30%; opacity: 0.4; } 50% { height: 100%; opacity: 1; } }
    </style>
</head>
<body>

    <div class="glow-bg"></div>

    <div class="main-container">
        
        <div class="header" id="mainHeader">
            <h1>GESTIONALE ROLEPLAY</h1>
        </div>

        <div class="glass-card">
            
            <div id="landingScreen" class="screen active">
                <div class="landing-flex">
                    <div class="viz-box">
                        <div class="bar" style="animation-delay: 0.1s"></div>
                        <div class="bar" style="animation-delay: 0.3s"></div>
                        <div class="bar" style="animation-delay: 0.5s"></div>
                        <div class="bar" style="animation-delay: 0.2s"></div>
                    </div>
                    <div>
                        <h2>Accesso richiesto</h2>
                        <p style="color: #aaa; line-height: 1.6;">Il gestionale √® un'app esclusiva per consultare i tuoi dati in tempo reale. Collega il tuo account per procedere.</p>
                        <button class="btn" onclick="showScreen('loginScreen')">Collega Account</button>
                    </div>
                </div>
            </div>

            <div id="loginScreen" class="screen">
                <h2 style="text-align:center; margin-top:0">Bentornato</h2>
                <div style="max-width: 400px; margin: 0 auto;">
                    <input type="text" id="logEmail" placeholder="Email o Nickname">
                    <input type="password" id="logPass" placeholder="Password">
                    <button class="btn" onclick="login()">Accedi</button>
                    <p style="text-align:center; font-size: 0.9rem; margin-top:20px;">Non hai un account? <span onclick="showScreen('regScreen')" style="color:var(--gold); cursor:pointer">Registrati</span></p>
                </div>
            </div>

            <div id="regScreen" class="screen">
                <h2 style="text-align:center; margin-top:0">Nuova Registrazione</h2>
                <div style="max-width: 400px; margin: 0 auto;">
                    <input type="text" id="regEmail" placeholder="Email">
                    <input type="text" id="regNick" placeholder="Nickname In-Game">
                    <input type="password" id="regPass" placeholder="Password">
                    <button class="btn" onclick="alert('Registrazione inviata al database!')">Crea Account</button>
                    <p style="text-align:center; font-size: 0.9rem; margin-top:20px;">Hai gi√† un account? <span onclick="showScreen('loginScreen')" style="color:var(--gold); cursor:pointer">Accedi</span></p>
                </div>
            </div>

            <div id="dashScreen" class="screen">
                <div class="sidebar">
                    <button class="side-btn active" onclick="tab('home')">üè†</button>
                    <button class="side-btn" onclick="tab('sanzioni')">‚öñÔ∏è</button>
                    <button id="staffIcon" class="side-btn" style="display:none;" onclick="tab('staff')">üõ°Ô∏è</button>
                </div>

                <div id="home" class="sub-tab">
                    <div style="display:flex; align-items:center; gap:20px;">
                        <img src="https://minotar.net/avatar/Steve" id="dashAvatar" style="width:80px; border-radius:20px; border:3px solid var(--gold)">
                        <h1>Buonasera, <br><span id="userDisp" style="color:var(--gold)">Adam Windsor</span></h1>
                    </div>

                    <div class="grid">
                        <div class="stat-card"><h4>üí∞ Portafoglio</h4><p id="dashBalance">0,00 ‚Ç¨</p></div>
                        <div class="stat-card"><h4>üíº Lavoro</h4><p id="dashJob">Disoccupato</p></div>
                        <div class="stat-card"><h4>üì± Telefono</h4><p>Non disponibile</p></div>
                        <div class="stat-card">
                            <h4>üîë Sblocca Staff</h4>
                            <input type="text" id="sCode" placeholder="Codice" style="margin-top:10px; padding:10px; font-size:0.8rem;">
                            <button class="btn" style="padding:10px; font-size:0.7rem;" onclick="unlockStaff()">ATTIVA</button>
                        </div>
                    </div>
                </div>

                <div id="sanzioni" class="sub-tab" style="display:none">
                    <h2>Le tue sanzioni</h2>
                    <div class="stat-card"><p style="font-size:1rem; color:#888">Nessun provvedimento disciplinare trovato.</p></div>
                </div>

                <div id="staff" class="sub-tab" style="display:none">
                    <h2 style="color:var(--gold)">Pannello Staff</h2>
                    <div class="stat-card"><p>Accesso amministratore abilitato. Puoi gestire i cittadini.</p></div>
                </div>
            </div>

        </div>
    </div>

    <script>
        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        function tab(id) {
            document.querySelectorAll('.sub-tab').forEach(t => t.style.display = 'none');
            document.getElementById(id).style.display = 'block';
            event.currentTarget.classList.add('active');
        }

        async function login() {
            const email = document.getElementById('logEmail').value;
            const password = document.getElementById('logPass').value;
            
            const res = await fetch('/api/login', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ email, password })
            });

            if(res.ok) {
                const data = await res.json();
                showScreen('dashScreen');
                document.getElementById('userDisp').innerText = data.email.split('@')[0];
                document.getElementById('dashBalance').innerText = (data.balance || 0) + " ‚Ç¨";
                document.getElementById('dashJob').innerText = data.lavoro || "Disoccupato";
                document.getElementById('dashAvatar').src = `https://minotar.net/avatar/${data.email.split('@')[0]}`;
            } else { alert("Errore: Account non trovato o password errata."); }
        }

        async function unlockStaff() {
            const code = document.getElementById('sCode').value;
            const res = await fetch('/api/unlock-staff', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ code })
            });
            const data = await res.json();
            if(data.success) {
                alert("Grado Staff Attivato!");
                document.getElementById('staffIcon').style.display = 'flex';
            } else { alert("Codice errato!"); }
        }
    </script>
</body>
</html>
